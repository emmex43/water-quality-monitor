{% extends "base.html" %}

{% block title %}Dashboard - Water Quality Monitor{% endblock %}

{% block content %}
<!-- Dashboard Header -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card bg-white border-0 shadow">
            <div class="card-body text-center py-4">
                <h1 class="display-5 fw-bold text-primary mb-2">Welcome, {{ user.name }}! ðŸ‘‹</h1>
                <p class="lead text-muted">Water Quality Monitoring Dashboard - SDG 6</p>
                <div class="row justify-content-center mt-3">
                    <div class="col-auto">
                        <span class="badge bg-info fs-6">
                            <i class="bi bi-building"></i> {{ user.organization or 'Individual' }}
                        </span>
                    </div>
                    <div class="col-auto">
                        <span class="badge bg-secondary fs-6">
                            <i class="bi bi-person-gear"></i> {{ user.role.title() }}
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Statistics Cards -->
<div class="row mb-4">
    <div class="col-md-3 mb-3">
        <div class="card stat-card text-white">
            <div class="card-body text-center">
                <i class="bi bi-droplet display-6 mb-2"></i>
                <h2 class="stat-number" id="totalReadings">0</h2>
                <p class="mb-0">Total Readings</p>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-3">
        <div class="card bg-white border-0 shadow">
            <div class="card-body text-center">
                <i class="bi bi-speedometer2 text-primary display-6 mb-2"></i>
                <h3 class="text-primary" id="latestPh">-</h3>
                <p class="text-muted mb-0">Latest pH Level</p>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-3">
        <div class="card bg-white border-0 shadow">
            <div class="card-body text-center">
                <i class="bi bi-eye text-info display-6 mb-2"></i>
                <h3 class="text-info" id="latestTurbidity">-</h3>
                <p class="text-muted mb-0">Turbidity (NTU)</p>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-3">
        <div class="card bg-white border-0 shadow">
            <div class="card-body text-center">
                <i class="bi bi-wind text-success display-6 mb-2"></i>
                <h3 class="text-success" id="latestOxygen">-</h3>
                <p class="text-muted mb-0">Dissolved Oxygen</p>
            </div>
        </div>
    </div>
</div>

<!-- Add New Reading Card -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card border-0 shadow">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0"><i class="bi bi-plus-circle"></i> Add New Water Reading</h4>
            </div>
            <div class="card-body">
                <form id="addReadingForm">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="location_name" class="form-label">Location Name</label>
                            <input type="text" class="form-control" id="location_name" name="location_name" required 
                                   placeholder="e.g., Community River, Village Well">
                        </div>
                        <div class="col-md-3">
                            <label for="ph_level" class="form-label">pH Level</label>
                            <input type="number" class="form-control" id="ph_level" name="ph_level" 
                                   step="0.1" min="0" max="14" placeholder="7.0">
                        </div>
                        <div class="col-md-3">
                            <label for="turbidity_ntu" class="form-label">Turbidity (NTU)</label>
                            <input type="number" class="form-control" id="turbidity_ntu" name="turbidity_ntu" 
                                   step="0.1" min="0" placeholder="2.5">
                        </div>
                        <div class="col-md-4">
                            <label for="dissolved_oxygen" class="form-label">Dissolved Oxygen (mg/L)</label>
                            <input type="number" class="form-control" id="dissolved_oxygen" name="dissolved_oxygen" 
                                   step="0.1" min="0" placeholder="8.2">
                        </div>
                        <div class="col-md-4">
                            <label for="temperature_c" class="form-label">Temperature (Â°C)</label>
                            <input type="number" class="form-control" id="temperature_c" name="temperature_c" 
                                   step="0.1" placeholder="22.5">
                        </div>
                        <div class="col-md-4">
                            <label for="conductivity_us" class="form-label">Conductivity (Î¼S/cm)</label>
                            <input type="number" class="form-control" id="conductivity_us" name="conductivity_us" 
                                   step="1" placeholder="350">
                        </div>
                        <div class="col-12">
                            <button type="submit" class="btn btn-primary btn-lg w-100">
                                <i class="bi bi-check-circle"></i> Add Water Reading
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Search and Filter Section -->
<div class="row mb-3">
    <div class="col-12">
        <div class="card border-0 shadow-sm">
            <div class="card-body">
                <div class="row g-2">
                    <div class="col-md-6">
                        <div class="input-group">
                            <span class="input-group-text"><i class="bi bi-search"></i></span>
                            <input type="text" id="searchInput" class="form-control" placeholder="Search locations...">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <select id="parameterFilter" class="form-select">
                            <option value="">All Parameters</option>
                            <option value="ph">pH Level</option>
                            <option value="turbidity">Turbidity</option>
                            <option value="oxygen">Dissolved Oxygen</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <select id="dateFilter" class="form-select">
                            <option value="">All Time</option>
                            <option value="7">Last 7 Days</option>
                            <option value="30">Last 30 Days</option>
                            <option value="90">Last 90 Days</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Water Readings Table -->
<div class="row">
    <div class="col-12">
        <div class="card border-0 shadow">
            <div class="card-header bg-white d-flex justify-content-between align-items-center">
                <h4 class="mb-0"><i class="bi bi-table"></i> Your Water Quality Readings</h4>
                <span class="badge bg-primary fs-6" id="readingCount">0 readings</span>
            </div>
            <div class="card-body">
                <div id="readingsTable">
                    <div class="text-center py-4">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-2 text-muted">Loading your water quality data...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Success Modal -->
<div class="modal fade" id="successModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title"><i class="bi bi-check-circle"></i> Success</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p id="successMessage">Operation completed successfully!</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-success" data-bs-dismiss="modal">Continue</button>
            </div>
        </div>
    </div>
</div>

<!-- Error Modal -->
<div class="modal fade" id="errorModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title"><i class="bi bi-exclamation-triangle"></i> Error</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p id="errorMessage">An error occurred.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}